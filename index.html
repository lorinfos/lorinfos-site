<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#0B0B0B" />
  <title>LORINFOS</title>
  <meta name="description" content="Des √©nigmes courtes pour tester ta logique. La plupart se trompent." />

  <style>
    :root{
      --gold: #D7A11E;
      --gold2:#F2D37A;
      --bg: #070708;
      --panel: rgba(255,255,255,0.06);
      --panel2: rgba(255,255,255,0.09);
      --stroke: rgba(255,255,255,0.12);
      --stroke2: rgba(215,161,30,0.30);
      --text: rgba(255,255,255,0.92);
      --muted: rgba(255,255,255,0.65);
      --shadow: 0 18px 60px rgba(0,0,0,0.55);
      --radius: 22px;
      --radius2: 18px;
      --max: 820px;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color: var(--text);
      background: radial-gradient(900px 420px at 50% 0%, rgba(215,161,30,0.22), transparent 60%),
                  radial-gradient(700px 380px at 20% 20%, rgba(242,211,122,0.12), transparent 60%),
                  linear-gradient(180deg, #0B0B0C 0%, #050506 100%);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      -webkit-tap-highlight-color: transparent; /* iOS: √©vite les ‚Äúflash‚Äù bleus */
    }

    a{ color:inherit; text-decoration:none; }

    .wrap{
      width: min(var(--max), 100%);
      margin: 0 auto;
      padding: 26px 16px 40px;
    }

    .hero{
      border-radius: 28px;
      background:
        radial-gradient(600px 240px at 15% 0%, rgba(215,161,30,0.22), transparent 60%),
        linear-gradient(180deg, rgba(255,255,255,0.08), rgba(255,255,255,0.04));
      border: 1px solid var(--stroke);
      box-shadow: var(--shadow);
      padding: 18px 16px 16px;
      position: relative;
      overflow: hidden;
    }

    .hero::after{
      content:"";
      position:absolute; inset:-2px;
      background: radial-gradient(520px 220px at 80% 10%, rgba(215,161,30,0.18), transparent 55%);
      pointer-events:none;
    }

    .brand{
      display:flex;
      gap:14px;
      align-items:center;
      z-index:1;
      position:relative;
    }

    .logo{
      width:62px; height:62px;
      border-radius: 16px;
      box-shadow: 0 12px 30px rgba(0,0,0,0.45);
      border: 1px solid rgba(255,255,255,0.10);
      background: rgba(0,0,0,0.35);
      object-fit: cover;
    }

    .brand h1{
      margin:0;
      font-size: 40px;
      letter-spacing: 0.06em;
      line-height: 1;
    }
    .brand p{
      margin:8px 0 0;
      color: var(--muted);
      font-size: 16px;
      line-height: 1.4;
      max-width: 420px;
    }

    .cta{
      margin-top: 14px;
      display:grid;
      grid-template-columns: 1fr;
      gap: 12px;
      z-index:1;
      position:relative;
    }

    .btn{
      border: 1px solid var(--stroke);
      border-radius: 999px;
      padding: 14px 16px;
      font-weight: 700;
      font-size: 18px;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      background: rgba(255,255,255,0.06);
      box-shadow: 0 14px 38px rgba(0,0,0,0.35);
      user-select:none;
      transition: transform .08s ease, filter .2s ease, background .2s ease;
      cursor:pointer;
    }
    .btn:active{ transform: translateY(1px) scale(0.99); }

    .btn-gold{
      border-color: rgba(215,161,30,0.35);
      background: linear-gradient(180deg, var(--gold2), var(--gold));
      color: #17130A;
      text-shadow: none;
    }
    .btn-dark{
      background: linear-gradient(180deg, rgba(255,255,255,0.10), rgba(255,255,255,0.05));
    }

    .section-title{
      margin: 18px 2px 10px;
      font-size: 44px;
      letter-spacing: -0.02em;
      display:flex;
      align-items:center;
      gap:10px;
    }

    .notice{
      border-radius: var(--radius);
      padding: 16px 16px;
      border: 1px solid rgba(215,161,30,0.25);
      background: linear-gradient(180deg, rgba(215,161,30,0.10), rgba(0,0,0,0.18));
      box-shadow: 0 18px 50px rgba(0,0,0,0.45);
      color: rgba(255,255,255,0.86);
      line-height: 1.45;
    }
    .notice b{ color: rgba(255,255,255,0.95); }

    .list{
      margin-top: 14px;
      display:grid;
      gap: 14px;
    }

    .card{
      border-radius: 22px;
      background: linear-gradient(180deg, rgba(255,255,255,0.08), rgba(255,255,255,0.04));
      border: 1px solid rgba(255,255,255,0.12);
      box-shadow: 0 18px 55px rgba(0,0,0,0.45);
      padding: 16px;
      overflow:hidden;
      position:relative;
    }

    .badge{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 8px 12px;
      border-radius: 999px;
      background: rgba(0,0,0,0.35);
      border: 1px solid rgba(255,255,255,0.12);
      color: rgba(255,255,255,0.88);
      font-weight: 800;
      letter-spacing: 0.01em;
    }

    .question{
      margin: 12px 0 14px;
      font-size: 24px;
      color: rgba(255,255,255,0.92);
      line-height: 1.25;
    }

    .card .btn{
      width: 100%;
      margin-top: 10px;
    }

    .hint{
      margin-top: 12px;
      color: rgba(255,255,255,0.62);
      font-size: 15px;
      line-height: 1.35;
    }

    .subtle{
      margin-top: 12px;
      border-radius: 999px;
      padding: 12px 14px;
      border: 1px solid rgba(255,255,255,0.12);
      background: rgba(255,255,255,0.06);
      color: rgba(255,255,255,0.75);
      text-align:center;
      font-weight: 600;
    }

    footer{
      margin-top: 26px;
      text-align:center;
      color: rgba(255,255,255,0.45);
      font-size: 14px;
    }

    /* ===== Modal (fix du probl√®me de transparence) ===== */
    .modalOverlay{
      position: fixed;
      inset: 0;
      display:none;
      align-items: flex-end;
      justify-content: center;
      padding: 16px;
      z-index: 9999;
      background: rgba(0,0,0,0.72); /* opaque => texte derri√®re invisible */
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
    }
    .modalOverlay.show{ display:flex; }

    .modal{
      width: min(var(--max), 100%);
      border-radius: 22px;
      background: linear-gradient(180deg, rgba(22,22,24,0.96), rgba(10,10,11,0.96));
      border: 1px solid rgba(255,255,255,0.14);
      box-shadow: 0 30px 90px rgba(0,0,0,0.65);
      padding: 14px 14px 16px;
      max-height: 78vh;
      overflow:auto;
    }

    .modalTop{
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 10px;
      margin-bottom: 10px;
    }
    .modalTitle{
      font-weight: 900;
      font-size: 18px;
      color: rgba(255,255,255,0.92);
    }
    .x{
      border: 1px solid rgba(255,255,255,0.18);
      background: rgba(255,255,255,0.06);
      color: rgba(255,255,255,0.85);
      border-radius: 999px;
      width: 40px;
      height: 34px;
      display:flex;
      align-items:center;
      justify-content:center;
      cursor:pointer;
      user-select:none;
    }
    .x:active{ transform: scale(0.98); }

    .modalBody{
      color: rgba(255,255,255,0.85);
      font-size: 16px;
      line-height: 1.45;
      white-space: pre-wrap;
    }
    .modalBody b{ color: rgba(255,255,255,0.95); }

    .row{
      display:flex;
      gap: 10px;
      margin-top: 12px;
      flex-wrap: wrap;
    }
    .smallBtn{
      flex: 1;
      min-width: 140px;
      border-radius: 14px;
      padding: 12px 12px;
      font-weight: 800;
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(255,255,255,0.06);
      color: rgba(255,255,255,0.90);
      cursor:pointer;
    }
    .smallBtn.gold{
      border-color: rgba(215,161,30,0.35);
      background: linear-gradient(180deg, var(--gold2), var(--gold));
      color: #17130A;
    }

    @media (max-width: 420px){
      .brand h1{ font-size: 34px; }
      .section-title{ font-size: 38px; }
      .question{ font-size: 22px; }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="hero">
      <div class="brand">
        <img class="logo" src="logo.png" alt="Logo LORINFOS" />
        <div>
          <h1>LORINFOS</h1>
          <p>Des √©nigmes courtes pour tester ta logique.<br/>La plupart se trompent.</p>
        </div>
      </div>

      <div class="cta">
        <button class="btn btn-gold" id="goEnigmes" type="button">üß© <span>√ânigmes & R√©ponses</span></button>
        <button class="btn btn-dark" id="goRessources" type="button">üß† <span>Muscler son cerveau</span></button>
      </div>
    </div>

    <h2 class="section-title" id="enigmes">üß© √ânigmes & R√©ponses</h2>

    <div class="notice">
      ‚ö†Ô∏è <b>Pour faire vivre le site</b>, certaines r√©ponses peuvent ouvrir une courte publicit√©.<br/>
      Ferme simplement l‚Äôonglet de pub et reviens ici : <b>la r√©ponse s‚Äôaffiche ensuite</b>.
    </div>

    <div class="list" id="enigmesList">
      <div class="subtle">Chargement des √©nigmes‚Ä¶</div>
    </div>

    <h2 class="section-title" id="ressources">üß† Muscler son cerveau</h2>

    <div class="list" id="ressourcesList">
      <div class="subtle">Chargement des ressources‚Ä¶</div>
    </div>

    <footer>¬© LORINFOS ‚Äî Tous droits r√©serv√©s.</footer>
  </div>

  <!-- Modal -->
  <div class="modalOverlay" id="modalOverlay" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal" id="modal">
      <div class="modalTop">
        <div class="modalTitle" id="modalTitle">R√©ponse</div>
        <div class="x" id="modalClose" aria-label="Fermer">‚úï</div>
      </div>
      <div class="modalBody" id="modalBody"></div>
      <div class="row" id="modalActions" style="display:none;"></div>
    </div>
  </div>

  <script>
    // ===== Helpers =====
    const $ = (id) => document.getElementById(id);

    function safeText(s){
      return (s ?? "").toString();
    }

    // ===== Smooth navigation =====
    $("goEnigmes").addEventListener("click", () => {
      location.hash = "#enigmes";
      document.querySelector("#enigmes").scrollIntoView({behavior:"smooth", block:"start"});
    });
    $("goRessources").addEventListener("click", () => {
      location.hash = "#ressources";
      document.querySelector("#ressources").scrollIntoView({behavior:"smooth", block:"start"});
    });

    // ===== Modal (opaque + blur + no-scroll behind) =====
    const overlay = $("modalOverlay");
    const body = document.body;

    function openModal(title, bodyText, actions = []){
      $("modalTitle").textContent = safeText(title || "Info");
      $("modalBody").textContent = safeText(bodyText);

      const actionsWrap = $("modalActions");
      actionsWrap.innerHTML = "";
      if(actions.length){
        actionsWrap.style.display = "flex";
        actions.forEach(a => {
          const b = document.createElement("button");
          b.className = "smallBtn" + (a.gold ? " gold" : "");
          b.type = "button";
          b.textContent = a.label;
          b.addEventListener("click", a.onClick);
          actionsWrap.appendChild(b);
        });
      }else{
        actionsWrap.style.display = "none";
      }

      overlay.classList.add("show");
      overlay.setAttribute("aria-hidden", "false");
      body.style.overflow = "hidden";
    }

    function closeModal(){
      overlay.classList.remove("show");
      overlay.setAttribute("aria-hidden", "true");
      body.style.overflow = "";
    }

    $("modalClose").addEventListener("click", closeModal);
    overlay.addEventListener("click", (e) => { if(e.target === overlay) closeModal(); });
    document.addEventListener("keydown", (e) => { if(e.key === "Escape") closeModal(); });

    // ===== Data loading =====
    async function fetchJson(path){
      const res = await fetch(path, { cache: "no-store" }); // √©vite les caches agressifs
      if(!res.ok) throw new Error(`HTTP ${res.status} sur ${path}`);
      return await res.json();
    }

    // ===== Affiliation (global) =====
    // enigmes.json: { affiliate_url: "...", enigmes: [...] }
    // ressources.json: { affiliate_url: "...", ressources: [...] }
    let enigmesAffiliate = "";
    let ressourcesAffiliate = "";

    function openAffiliateThenShowAnswer(affiliateUrl, answerTitle, answerText){
      const url = (affiliateUrl || "").trim();
      // 1) ouvre pub si url, 2) montre la r√©ponse tout de suite (ou apr√®s retour)
      if(url){
        try{ window.open(url, "_blank", "noopener,noreferrer"); }catch(_){}
      }
      openModal(answerTitle, answerText);
    }

    // ===== Render enigmes =====
    function renderEnigmes(list){
      const wrap = $("enigmesList");
      wrap.innerHTML = "";

      if(!Array.isArray(list) || list.length === 0){
        wrap.innerHTML = `<div class="subtle">Aucune √©nigme pour l‚Äôinstant. Ajoute-en dans enigmes.json ‚úÖ</div>`;
        return;
      }

      list.forEach((e) => {
        const card = document.createElement("div");
        card.className = "card";

        const badge = document.createElement("div");
        badge.className = "badge";
        badge.textContent = `${safeText(e.badge || "üíé")} ${safeText(e.titre || "√ânigme")}`;

        const q = document.createElement("div");
        q.className = "question";
        q.textContent = safeText(e.question);

        const btn = document.createElement("button");
        btn.className = "btn btn-gold";
        btn.type = "button";
        btn.innerHTML = `üëâ <span>Voir la r√©ponse</span>`;
        btn.addEventListener("click", () => {
          const title = safeText(e.titre || "R√©ponse");
          const answer = safeText(e.reponse || "R√©ponse non disponible.");
          openAffiliateThenShowAnswer(enigmesAffiliate, title, `R√©ponse :\n${answer}`);
        });

        const hint = document.createElement("div");
        hint.className = "hint";
        hint.textContent = safeText(e.astuce || "");

        card.appendChild(badge);
        card.appendChild(q);
        card.appendChild(btn);
        if(hint.textContent.trim()) card.appendChild(hint);

        wrap.appendChild(card);
      });
    }

    // ===== Render ressources =====
    function renderRessources(list){
      const wrap = $("ressourcesList");
      wrap.innerHTML = "";

      if(!Array.isArray(list) || list.length === 0){
        wrap.innerHTML = `<div class="subtle">Aucune ressource pour l‚Äôinstant. Ajoute-en dans ressources.json ‚úÖ</div>`;
        return;
      }

      list.forEach((r) => {
        const card = document.createElement("div");
        card.className = "card";

        const badge = document.createElement("div");
        badge.className = "badge";
        badge.textContent = `${safeText(r.badge || "üß†")} ${safeText(r.titre || "Ressource")}`;

        const desc = document.createElement("div");
        desc.className = "question";
        desc.style.fontSize = "20px";
        desc.style.lineHeight = "1.28";
        desc.textContent = safeText(r.description || "");

        const btn = document.createElement("button");
        btn.className = "btn btn-dark";
        btn.type = "button";
        btn.innerHTML = `üõí <span>Voir / Acheter</span>`;
        btn.addEventListener("click", () => {
          // si r.url existe => prioritaire, sinon global ressourcesAffiliate
          const url = (safeText(r.url).trim() || ressourcesAffiliate || "").trim();
          if(!url){
            openModal("Lien indisponible", "Ajoute un lien (url) dans ressources.json, ou un affiliate_url global.");
            return;
          }
          try{ window.open(url, "_blank", "noopener,noreferrer"); }catch(_){}
        });

        card.appendChild(badge);
        if(desc.textContent.trim()) card.appendChild(desc);
        card.appendChild(btn);

        wrap.appendChild(card);
      });
    }

    // ===== Init =====
    (async function init(){
      try{
        const dataE = await fetchJson("enigmes.json");
        enigmesAffiliate = safeText(dataE.affiliate_url || "");
        renderEnigmes(dataE.enigmes || []);
      }catch(err){
        $("enigmesList").innerHTML =
          `<div class="subtle">Erreur de chargement (enigmes.json). V√©rifie le nom du fichier et le format JSON ‚úÖ</div>`;
        console.error(err);
      }

      try{
        const dataR = await fetchJson("ressources.json");
        ressourcesAffiliate = safeText(dataR.affiliate_url || "");
        renderRessources(dataR.ressources || []);
      }catch(err){
        $("ressourcesList").innerHTML =
          `<div class="subtle">Erreur de chargement (ressources.json). V√©rifie le nom du fichier et le format JSON ‚úÖ</div>`;
        console.error(err);
      }

      // Si on arrive avec un #hash
      if(location.hash){
        const id = location.hash.replace("#", "");
        const el = document.getElementById(id);
        if(el) el.scrollIntoView({behavior:"smooth", block:"start"});
      }
    })();
  </script>
</body>
</html>
